---
title: "behavior_pilot1"
author: "Wanjia Guo"
date: "9/29/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r echo = FALSE}
knitr::opts_chunk$set(echo=FALSE)
```

```{r setup, include=FALSE}
library(gt)
library(fs)
library(purrr)
library(tidyverse)

# Loading behavioral data
sub_dir = dir_ls(here::here("../study_design/behavioral_code/Monstera_testingroom/data/"))
prescan_behav <- map(sub_dir, dir_ls, glob = '*prescan*_behav*.csv') %>% unlist()
scan_behav <- map(sub_dir, dir_ls, regexp = '(.*)_scan\\d_behav_.*') %>% unlist()

prescan_batch <- map_dfr(prescan_behav, read_csv)
scan_batch <- map_dfr(scan_behav, read_csv)


```

## n = `r nrow(prescan_batch)/24`

# Prescan analysis

```{r}
prescan_batch = prescan_batch %>% mutate(
  nquestion = rep(c(1, 2, 3), times = nrow(prescan_batch)/3),
  correct = ifelse(resp_obj == destination, 1, 0),
  confidence = ifelse(conf_resp == 6, 1, 0))

prescan_batch %>% 
  mutate(round_text = paste0('Round',round)) %>% 
  group_by(round_text, nquestion) %>% 
  summarise(m = mean(correct),
            conf = mean(confidence)) %>% 
  gt() %>% cols_align(align = 'left')
```

Participant were instructed to answer the expected destination for 3 times during the route: once at Same, once at Overlapping, and once at non-overlapping. They also indicated their confidence towards the choice (sure vs. unsure). Round 1 and 2 have same accuracy during the same route, but accuracy is increase during round 2 for overlapping and non-overlapping segment.

# Scan analysis


```{r}

scan_batch = scan_batch %>% mutate(
  correct = ifelse(post_first_resp_obj == destination, 1, 0))

scan_batch %>% group_by(valid) %>% 
  summarise(m_correct = mean(correct)) %>% 
  gt() %>% 
  cols_align(align = 'left') %>% 
  cols_label(valid = "", m_correct = "% correct")
```
Percentage of correct for the question after seeing the whole route, separating by valid vs. invalid cue. Participants were instructed to indicate where they though they were going when pressing the button in the middle of the route. The answer for invalid is very sligly lower than valid.


```{r fig.width=16, fig.height=8}
nest_scan_batch = scan_batch %>% group_by(destination, route) %>% 
  filter(i_pic != -999) %>% 
  mutate(destination = as.factor(destination)) %>% 
  nest()


nest_scan_fig = nest_scan_batch %>% 
  mutate(nest_plot = pmap(list(data, destination, route),~{
    ggplot(..1, aes(x=i_pic, fill = sub)) + 
      geom_histogram(bins = 20)+
      labs(title = ..2,
           subtitle = ..3,
           x = 'Index')+
      theme_minimal()})) %>% 
  arrange(route)

ggpubr::ggarrange(nest_scan_fig$nest_plot[[1]],
                  nest_scan_fig$nest_plot[[2]],
                  nest_scan_fig$nest_plot[[3]],
                  nest_scan_fig$nest_plot[[4]],
                  nest_scan_fig$nest_plot[[5]],
                  nest_scan_fig$nest_plot[[6]],
                  nest_scan_fig$nest_plot[[7]],
                  nest_scan_fig$nest_plot[[8]],
                  ncol = 4, nrow = 2,
                  common.legend = FALSE,
                  legend = 'bottom')
```

The index is the picture when participant pressed button to indicate they are SURE of the destination. One distribution is drawn for each destination, colored by different participant.
(1-25: Same; 26-75: Overlapping; 76-100: Non-overlapping).
